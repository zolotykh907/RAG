# Инструкция по запуску и настройке системы

## Backend

### 1. Установка зависимостей

```bash
cd documentation/backend
source venv/bin/activate  # Виртуальное окружение уже создано
pip install -r requirements.txt
```

### 2. Запуск PostgreSQL

```bash
brew services start postgresql@14
```

### 3. Применение миграций (если еще не применены)

```bash
alembic upgrade head
```

### 4. Запуск сервера

```bash
python3 main.py
```

Сервер запустится на http://localhost:8000

### 5. Создание 4 страниц через Swagger UI

1. Откройте http://localhost:8000/docs в браузере
2. Найдите эндпоинт `POST /pages`
3. Нажмите "Try it out"
4. Создайте 4 страницы с следующими данными:

**Страница 1 - Введение:**
```json
{
  "name": "Введение",
  "url": "/introduction"
}
```

**Страница 2 - Описание:**
```json
{
  "name": "Описание",
  "url": "/description"
}
```

**Страница 3 - Заключение:**
```json
{
  "name": "Заключение",
  "url": "/testing"
}
```

**Страница 4 - API:**
```json
{
  "name": "API",
  "url": "/api"
}
```

5. Для каждой страницы нажмите "Execute" и проверьте, что статус ответа 201

## Frontend (React)

### 1. Установка зависимостей

```bash
cd documentation/react-app
npm install
```

### 2. Запуск приложения

```bash
npm start
```

Приложение откроется на http://localhost:3000

## Проверка работы системы

1. Откройте React приложение (http://localhost:3000)
2. Перейдите на страницы:
   - Введение
   - Описание
   - Заключение (Testing)
   - API
3. Походите по этим страницам, задержитесь на каждой
4. Перейдите на страницу "Статистика" (http://localhost:3000/statistics)
5. Проверьте, что:
   - Отображаются все 4 страницы
   - Количество посещений увеличивается
   - Время на странице учитывается

## API Endpoints

- `POST /pages` - Создать новую страницу
- `GET /pages/{page_id}` - Получить страницу по ID
- `POST /pages/{page_id}/visit` - Увеличить счетчик посещений
- `POST /pages/{page_id}/time` - Обновить время на странице
- `GET /kpi` - Получить статистику по всем страницам

## Структура базы данных

### Таблица `pages`
- `id` - Primary Key
- `name` - Название страницы (уникальное)
- `url` - URL страницы (уникальный)

### Таблица `kpi`
- `id` - Primary Key
- `page_id` - Foreign Key на таблицу pages
- `visits` - Количество посещений
- `total_time_seconds` - Общее время на странице (в секундах)

## Как работает трекинг

1. При открытии страницы автоматически отправляется запрос `POST /pages/{page_id}/visit`
2. Начинается отсчет времени
3. При переходе на другую страницу или закрытии вкладки отправляется запрос `POST /pages/{page_id}/time` с проведенным временем
4. Данные обновляются в базе данных
5. На странице "Статистика" данные обновляются каждые 5 секунд
